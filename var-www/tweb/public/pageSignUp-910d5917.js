import{L as ot}from"./loginPage-db42028c.js";import{a as H,b as rt,P as ht,p as lt}from"./page-a83e8811.js";import{q as Z,M as ct,j as V,t as dt,u as W,v as J,w as pt,a as I,e as z,E as ut,x as B,c as Q,g as mt,i as D,I as ft}from"./index-d9a2bfe9.js";import{a as vt,L as gt,t as bt,b as $,c as yt,I as q,r as G,w as Et}from"./wrapEmojiText-52efa31a.js";import{B as F,I as M,r as Lt}from"./button-38e16a92.js";import{S as wt}from"./scrollable-18edb7c3.js";function Ct(i){return Z&&i instanceof TouchEvent&&i.touches[0].clientX<30}class St{constructor(){if(this.onPopState=t=>{const n=window.location.hash,e=t.state;if(this.debug&&this.log("popstate",t,this.isPossibleSwipe,n),n!==this.currentHash)if(this.debug&&this.log.warn(`hash changed, new=${n}, current=${this.currentHash}, overridden=${this.overriddenHash}`),e===this.id&&this.overriddenHash&&this.overriddenHash!==n)this.overrideHash(this.overriddenHash);else if(e&&!this.overriddenHash&&n)this.overrideHash();else{this.currentHash=n,this.onHashChange&&this.onHashChange();return}if(e!==this.id&&(this.pushState(),!this.navigations.length))return;const a=this.navigations.pop();if(!a){this.pushState();return}this.manual=!this.isPossibleSwipe,this.handleItem(a,this.navigations.length)},this.onKeyDown=t=>{const n=this.navigations[this.navigations.length-1];n&&t.key==="Escape"&&(!n.onEscape||n.onEscape())&&(V(t),this.back(n.type))},this.onTouchStart=t=>{t.touches.length>1||(this.debug&&this.log("touchstart"),Ct(t)&&(this.isPossibleSwipe=!0,window.addEventListener("touchend",()=>{setTimeout(()=>{this.isPossibleSwipe=!1},100)},{passive:!0,once:!0})))},this.navigations=[],this.id=Date.now(),this.manual=!1,this.log=dt("NC"),this.debug=!0,this.currentHash=window.location.hash,this.overriddenHash="",this.isPossibleSwipe=!1,window.addEventListener("popstate",this.onPopState),window.addEventListener("keydown",this.onKeyDown,{capture:!0,passive:!1}),Z){const t={passive:!0};window.addEventListener("touchstart",this.onTouchStart,t)}history.scrollRestoration="manual",this.pushState()}overrideHash(t=""){t&&t[0]!=="#"?t="#"+t:t==="#"&&(t=""),this.currentHash!==t&&(this.overriddenHash=this.currentHash=t,this.replaceState(),this.pushState())}handleItem(t,n=this.navigations.indexOf(t)){const e=t.onPop(this.manual?void 0:!1);this.debug&&this.log("popstate, navigation:",t,this.navigations),e===!1?this.spliceItems(Math.min(this.navigations.length,n),0,t):t.noBlurOnPop||W(),this.manual=!1}findItemByType(t){for(let n=this.navigations.length-1;n>=0;--n){const e=this.navigations[n];if(e.type===t)return{item:e,index:n}}}back(t){if(t){const n=this.findItemByType(t);if(n){this.backByItem(n.item,n.index);return}}history.back()}backByItem(t,n=this.navigations.indexOf(t)){n!==-1&&(this.manual=!0,this.navigations.splice(n,1),this.handleItem(t,n))}onItemAdded(t){this.debug&&this.log("onItemAdded",t,this.navigations),t.noHistory||this.pushState()}pushItem(t){this.navigations.push(t),this.onItemAdded(t)}unshiftItem(t){this.navigations.unshift(t),this.onItemAdded(t)}spliceItems(t,n,...e){this.navigations.splice(t,n,...e),e.forEach(a=>{this.onItemAdded(a)})}pushState(){this.debug&&this.log("push"),this.manual=!1,history.pushState(this.id,"")}replaceState(){this.debug&&this.log.warn("replace");const t=location.origin+location.pathname+location.search+this.overriddenHash;history.replaceState(this.id,"",t)}removeItem(t){t&&J(this.navigations,t)}removeByType(t,n=!1){for(let e=this.navigations.length-1;e>=0&&!(this.navigations[e].type===t&&(this.navigations.splice(e,1),n));--e);}}const O=new St;ct.appNavigationController=O;function Pt(i){if(i.key==="Enter"&&!pt&&!i.isComposing){if(I.settings.sendShortcut==="enter")return i.shiftKey||i.ctrlKey||i.metaKey?void 0:!0;{const t=z?i.metaKey:i.ctrlKey;if(i.shiftKey||(z?i.ctrlKey:i.metaKey))return;if(t)return!0}}return!1}function It(i,t,n){const e=n?n.add(i):i.addEventListener.bind(i);"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange".split(" ").forEach(a=>{e(a,t,!1)})}function kt(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}const At=(i,t={})=>{const n=i?.split(" ");return F("btn-icon"+(n?.length>1?" "+n.slice(1).join(" "):""),{icon:n?.[0]||void 0,...t})},R=document.body;let P=R;const tt=()=>{P=kt()||R,_.reAppend()};It(R,tt);const C=class extends ut{constructor(i,t={}){if(super(!1),this.element=document.createElement("div"),this.container=document.createElement("div"),this.header=document.createElement("div"),this.title=document.createElement("div"),this.element.classList.add("popup"),this.element.className="popup"+(i?" "+i:""),this.container.classList.add("popup-container","z-depth-1"),B.isDarkOverlayActive&&(this.night=!0,this.element.classList.add("night")),this.header.classList.add("popup-header"),t.title&&(this.title.classList.add("popup-title"),typeof t.title=="string"?Q(this.title,t.title):typeof t.title!="boolean"&&this.title.append(t.title),this.header.append(this.title)),this.isConfirmationNeededOnClose=t.isConfirmationNeededOnClose,this.middlewareHelper=vt(),this.listenerSetter=new gt,this.managers=C.MANAGERS,this.confirmShortcutIsSendShortcut=t.confirmShortcutIsSendShortcut,t.closable&&(this.btnClose=At("",{noRipple:!0}),this.btnClose.classList.add("popup-close"),this.header.prepend(this.btnClose),t.onBackClick?(this.btnCloseAnimatedIcon=document.createElement("div"),this.btnCloseAnimatedIcon.classList.add("animated-close-icon"),this.btnClose.append(this.btnCloseAnimatedIcon)):this.btnClose.append(M("close")),H(this.btnClose,()=>{t.onBackClick&&this.btnCloseAnimatedIcon.classList.contains("state-back")?(this.btnClose.classList.remove("state-back"),t.onBackClick()):this.hide()},{listenerSetter:this.listenerSetter})),this.withoutOverlay=t.withoutOverlay,this.withoutOverlay&&this.element.classList.add("no-overlay"),t.overlayClosable&&H(this.element,n=>{mt(n.target,"popup-container")||!n.target.isConnected||this.hide()},{listenerSetter:this.listenerSetter}),t.withConfirm&&(this.btnConfirm=document.createElement("button"),this.btnConfirm.classList.add("btn-primary","btn-color-primary"),t.withConfirm!==!0&&this.btnConfirm.append(D(t.withConfirm)),this.header.append(this.btnConfirm)),this.container.append(this.header),t.body&&(this.body=document.createElement("div"),this.body.classList.add("popup-body"),this.container.append(this.body)),t.scrollable){const n=this.scrollable=new wt(this.body);if(this.attachScrollableListeners(),t.floatingHeader){this.attachScrollableListeners(this.header);const e=document.createElement("div");e.classList.add("popup-header-background"),this.header.prepend(e),this.header.classList.add("is-floating")}this.body||this.header.after(n.container)}t.footer&&(this.footer=document.createElement("div"),this.footer.classList.add("popup-footer"),(this.body||this.container).append(this.footer)),this.btnConfirmOnEnter=this.btnConfirm,this.setButtons(t.buttons),this.element.append(this.container),C.POPUPS.push(this)}setButtons(i){if(this.buttons=i,this.buttonsEl&&(this.buttonsEl.remove(),this.buttonsEl=void 0),!i?.length)return;const t=this.buttonsEl=document.createElement("div");t.classList.add("popup-buttons");const n=i.map(e=>{const a=document.createElement("button");if(a.className="popup-button btn"+(e.isDanger?" danger":" primary"),e.noRipple||Lt(a),e.text?a.append(e.text):e.langKey&&a.append(D(e.langKey,e.langArgs)),e.iconLeft||e.iconRight){const m=M(e.iconLeft||e.iconRight,"popup-button-icon",e.iconLeft?"left":"right");a.classList.add("with-icon"),e.iconLeft?a.prepend(m):a.append(m)}return H(a,async m=>{let r=e.callback?.(m);if(r!==void 0&&r instanceof Promise){const l=bt([e.element],!0);try{r=await r}catch{r=!1}r===!1&&l()}r!==!1&&this.hide()},{listenerSetter:this.listenerSetter}),e.element=a});if(!this.btnConfirmOnEnter&&i.length===2){const e=i.find(a=>!a.isCancel);e&&(this.btnConfirmOnEnter=e.element)}i.length>=3&&t.classList.add("is-vertical-layout"),t.append(...n),this.container.append(t)}attachScrollableListeners(i){return this.scrollable.attachBorderListeners(i)}onContentUpdate(){this.scrollable?.onAdditionalScroll?.()}show(){this.navigationItem={type:"popup",onPop:()=>{if(this.isConfirmationNeededOnClose){const i=this.isConfirmationNeededOnClose();if(i)return Promise.resolve(i).then(()=>{this.destroy()}),!1}return this.destroy()}},O.pushItem(this.navigationItem),W(),P.append(this.element),this.element.offsetWidth,this.element.classList.add("active"),this.onContentUpdate(),this.withoutOverlay||(B.isOverlayActive=!0,$.checkAnimations2(!0)),setTimeout(()=>{this.element.classList.contains("active")&&this.listenerSetter.add(document.body)("keydown",i=>{!this.btnConfirmOnEnter||this.btnConfirmOnEnter.disabled||C.POPUPS[C.POPUPS.length-1]!==this||(this.confirmShortcutIsSendShortcut?Pt(i):i.key==="Enter")&&(rt(this.btnConfirmOnEnter),V(i))})},0)}hide(){this.destroyed||!this.navigationItem||O.backByItem(this.navigationItem)}hideWithCallback(i){this.addEventListener("closeAfterTimeout",i),this.hide()}forceHide(){return this.destroy()}destroy(){this.destroyed||(this.destroyed=!0,this.dispatchEvent("close"),this.element.classList.add("hiding"),this.element.classList.remove("active"),this.listenerSetter.removeAll(),this.middlewareHelper.destroy(),this.withoutOverlay||(B.isOverlayActive=!1),O.removeItem(this.navigationItem),this.navigationItem=void 0,J(C.POPUPS,this),tt(),setTimeout(()=>{this.element.remove(),this.dispatchEvent("closeAfterTimeout"),this.cleanup(),this.scrollable?.destroy(),this.withoutOverlay||$.checkAnimations2(!1)},250))}static reAppend(){this.POPUPS.forEach(i=>{const{element:t,container:n}=i,e=t.parentElement;e&&e!==P&&P!==n&&P.append(t)})}static getPopups(i){return this.POPUPS.filter(t=>t instanceof i)}static createPopup(i,...t){return new i(...t)}};let _=C;_.POPUPS=[];function Ht(i,t){let n,e,a,m=0,r=0,l=0,f=0,u=0;const d=4,h={},g=50,y=200,S=200;i.complete?K():i.onload=K;function b(){e.removeEventListener("mousedown",k),e.removeEventListener("touchstart",k),e.removeEventListener("wheel",j),document.removeEventListener("mouseup",E),document.removeEventListener("touchend",E),document.removeEventListener("mousemove",L),document.removeEventListener("touchmove",L),document.removeEventListener("keypress",X),n.remove(),e.remove(),a.remove()}function et(){e.addEventListener("mousedown",k,!1),e.addEventListener("touchstart",k,!1),e.addEventListener("wheel",j,!1),document.addEventListener("keypress",X,!1)}function K(){i.classList.add("crop-blur"),i.draggable=!1,a=new Image,a.src=i.src,a.draggable=!1,a.classList.add("crop-overlay-image"),t||(t=document.createElement("canvas")),n=document.createElement("div"),n.classList.add("crop-component"),e=document.createElement("div"),e.classList.add("crop-overlay");const s=document.createElement("div");s.classList.add("crop-overlay-color"),n.appendChild(e),i.parentNode.appendChild(n),n.appendChild(a),n.appendChild(i),n.appendChild(s),e.appendChild(a),a.style.maxWidth=i.width+"px",u=i.naturalWidth/i.offsetWidth;const p=i.offsetWidth/2-y/2,c=i.offsetHeight/2-S/2;Y(y,S),x(p,c),T(p,c),et()}function Y(s,o){l=s*u,f=o*u,e.style.width=s+"px",e.style.height=o+"px"}function x(s,o){r=o*u,m=s*u,a.style.top=-o+"px",a.style.left=-s+"px"}function T(s,o){e.style.top=o+"px",e.style.left=s+"px"}function it(s){h.container_width=e.offsetWidth,h.container_height=e.offsetHeight,h.container_left=e.offsetLeft,h.container_top=e.offsetTop,h.mouse_x=(s.clientX||s.pageX||s.touches&&s.touches[0].clientX)+window.scrollX,h.mouse_y=(s.clientY||s.pageY||s.touches&&s.touches[0].clientY)+window.scrollY}function N(s){s=s*Math.PI*2;const o=Math.floor(e.clientWidth+s),p=Math.floor(e.clientHeight+s),c=a.clientWidth,A=a.clientHeight;let v,w;if(o<g)return;if(o>c)return;v=e.offsetLeft-s/2,w=e.offsetTop-s/2;const st=v+o,at=w+p;v<0&&(v=0),w<0&&(w=0),!(st>c)&&(at>A||(Y(o,o),x(v,w),T(v,w)))}function X(s){switch(s.preventDefault(),String.fromCharCode(s.charCode)){case"+":N(d);break;case"-":N(-d);break}}function j(s){s.preventDefault(),N(s.deltaY>0?1:-1)}function k(s){s.preventDefault(),s.stopPropagation(),it(s),document.addEventListener("mousemove",L),document.addEventListener("touchmove",L),document.addEventListener("mouseup",E),document.addEventListener("touchend",E)}function E(s){s.preventDefault(),document.removeEventListener("mouseup",E),document.removeEventListener("touchend",E),document.removeEventListener("mousemove",L),document.removeEventListener("touchmove",L)}function L(s){const o={x:0,y:0};s.preventDefault(),s.stopPropagation(),o.x=s.pageX||s.touches&&s.touches[0].pageX,o.y=s.pageY||s.touches&&s.touches[0].pageY;let p=o.x-(h.mouse_x-h.container_left),c=o.y-(h.mouse_y-h.container_top);const A=e.offsetWidth,v=e.offsetHeight;p<0?p=0:p>a.offsetWidth-A&&(p=a.offsetWidth-A),c<0?c=0:c>a.offsetHeight-v&&(c=a.offsetHeight-v),x(p,c),T(p,c)}function nt(){t.width=l,t.height=f,t.getContext("2d").drawImage(i,m,r,l,f,0,0,l,f)}return{crop:nt,removeHandlers:b}}function Ot(i,t){return new Promise(n=>{const e=new FileReader;e.addEventListener("loadend",a=>{n(a.target.result)}),e[t](i)})}function _t(i){return Ot(i,"readAsDataURL")}class xt extends _{constructor(t={}){super("popup-avatar",{closable:!0}),this.image=new Image,this.cropper={crop:()=>{},removeHandlers:()=>{}},this.h6=document.createElement("h6"),Q(this.h6,"Popup.Avatar.Title"),this.btnClose.classList.remove("btn-icon"),this.header.append(this.h6),this.cropContainer=document.createElement("div"),this.cropContainer.classList.add("crop"),this.cropContainer.append(this.image),t.isForum&&this.cropContainer.classList.add("is-forum"),this.input=document.createElement("input"),this.input.type="file",this.input.style.display="none",this.listenerSetter.add(this.input)("change",n=>{const e=n.target.files[0];e&&_t(e).then(a=>{this.image=new Image,this.cropContainer.append(this.image),this.image.src=a,this.image.onload=()=>{this.show(),this.cropper=Ht(this.image,this.canvas),this.input.value=""}})},!1),this.btnConfirm=F("btn-primary btn-color-primary btn-circle btn-crop btn-icon z-depth-1",{noRipple:!0,icon:"check"}),H(this.btnConfirm,()=>{this.cropper.crop(),this.hide(),this.canvas.toBlob(n=>{this.blob=n,this.darkenCanvas(),this.resolve()},"image/jpeg",1)},{listenerSetter:this.listenerSetter}),this.container.append(this.cropContainer,this.btnConfirm,this.input),this.addEventListener("closeAfterTimeout",()=>{this.cropper.removeHandlers(),this.image&&this.image.remove()})}resolve(){this.onCrop(()=>yt.upload(this.blob))}open(t,n){this.canvas=t,this.onCrop=n,this.input.click()}darkenCanvas(){const t=this.canvas.getContext("2d");t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,this.canvas.width,this.canvas.height)}}let U=null;const Tt=async()=>{const i=new ot({className:"page-signUp",withInputWrapper:!0,titleLangKey:"YourName",subtitleLangKey:"Login.Register.Subtitle"});i.imageDiv.classList.add("avatar-edit"),i.title.classList.add("fullName");const t=document.createElement("canvas");t.id="canvas-avatar",t.className="avatar-edit-canvas";const n=M("cameraadd","avatar-edit-icon");i.imageDiv.append(t,n);let e;i.imageDiv.addEventListener("click",()=>{_.createPopup(xt).open(t,d=>{e=d})});const a=d=>{const h=r.value||"",g=l.value||"",y=h||g?(h+" "+g).trim():"";y?G(i.title,Et(y)):G(i.title,D("YourName"))},m=()=>new Promise((d,h)=>{if(!e)return d();e().then(g=>{I.managers.appProfileManager.uploadProfilePhoto(g).then(d,h)},h)}),r=new q({label:"FirstName",maxLength:70}),l=new q({label:"LastName",maxLength:64}),f=F("btn-primary btn-color-primary"),u=new ft.IntlElement({key:"StartMessaging"});return f.append(u.element),i.inputWrapper.append(r.container,l.container,f),r.input.addEventListener("input",a),l.input.addEventListener("input",a),f.addEventListener("click",function(d){if(r.input.classList.contains("error")||l.input.classList.contains("error"))return!1;if(!r.value.length)return r.input.classList.add("error"),!1;this.disabled=!0;const h=r.value.trim(),g=l.value.trim(),y={phone_number:U.phone_number,phone_code_hash:U.phone_code_hash,first_name:h,last_name:g};u.update({key:"PleaseWait"});const S=lt(this);I.managers.apiManager.invokeApi("auth.signUp",y).then(b=>{switch(b._){case"auth.authorization":I.managers.apiManager.setUser(b.user),m().finally(()=>{});break;default:u.update({key:b._}),this.removeAttribute("disabled"),S.remove();break}}).catch(b=>{switch(this.removeAttribute("disabled"),S.remove(),b.type){default:u.update({key:b.type});break}})}),W(),new Promise(d=>{window.requestAnimationFrame(d)})},Ft=new ht("page-signUp",!0,Tt,i=>{U=i,I.managers.appStateManager.pushToState("authState",{_:"authStateSignUp",authCode:i})});export{Ft as default};
//# sourceMappingURL=pageSignUp-910d5917.js.map
