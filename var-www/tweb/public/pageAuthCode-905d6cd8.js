import{r as A,i as g,a as E,_,m as C}from"./index-d9a2bfe9.js";import{P as b,a as S}from"./page-a83e8811.js";import F from"./pageSignIn-434b1a94.js";import{l as h,I as k,s as L,r as y}from"./wrapEmojiText-52efa31a.js";import{I as T}from"./button-38e16a92.js";import"./pageSignQR-f06ed543.js";import"./scrollable-18edb7c3.js";class w{constructor(t,e){this.inputField=t,this.size=e,this.max=45,this.needFrame=0,this.container=document.createElement("div"),this.container.classList.add("media-sticker-wrapper");const i=t.input;i.addEventListener("blur",()=>{this.playAnimation(0)}),i.addEventListener("input",d=>{this.playAnimation(t.value.length)})}playAnimation(t){if(!this.animation)return;t=Math.min(t,30);let e;t?(e=Math.round(Math.min(this.max,t)*(165/this.max)+11.33),this.idleAnimation&&(this.idleAnimation.stop(!0),this.idleAnimation.canvas[0].style.display="none"),this.animation.canvas[0].style.display=""):e=0;const i=this.needFrame>e?-1:1;this.animation.setDirection(i),this.needFrame!==0&&e===0&&this.animation.setSpeed(7),this.needFrame=e,this.animation.play()}load(){return this.loadPromise?this.loadPromise:this.loadPromise=Promise.all([h.loadAnimationAsAsset({container:this.container,loop:!0,autoplay:!0,width:this.size,height:this.size},"TwoFactorSetupMonkeyIdle").then(t=>(this.idleAnimation=t,this.inputField.value.length||t.play(),h.waitForFirstFrame(t))),h.loadAnimationAsAsset({container:this.container,loop:!1,autoplay:!1,width:this.size,height:this.size},"TwoFactorSetupMonkeyTracking").then(t=>(this.animation=t,this.inputField.value.length||(this.animation.canvas[0].style.display="none"),this.animation.addEventListener("enterFrame",e=>{(this.animation.direction===1&&e>=this.needFrame||this.animation.direction===-1&&e<=this.needFrame)&&(this.animation.setSpeed(1),this.animation.pause()),e===0&&this.needFrame===0&&this.idleAnimation&&(this.idleAnimation.canvas[0].style.display="",this.idleAnimation.play(),this.animation.canvas[0].style.display="none")}),h.waitForFirstFrame(t)))])}remove(){this.animation&&this.animation.remove(),this.idleAnimation&&this.idleAnimation.remove()}}class I extends k{constructor(t){super(Object.assign(t,{plainText:!0})),this.options=t;const e=this.input;e.type="tel",e.setAttribute("required",""),e.autocomplete="off";let i=0;this.input.addEventListener("input",d=>{this.input.classList.remove("error"),this.setLabel();const n=this.value.replace(/\D/g,"").slice(0,t.length);this.setValueSilently(n);const u=this.value.length;if(u===t.length)t.onFill(this.value);else if(u===i)return;i=u})}}let r=null,c=null,f=null,o,s,l,p;const v=()=>{setTimeout(()=>{l?.remove(),p?.remove()},300)},P=a=>{o.setAttribute("disabled","true");const t={phone_number:r.phone_number,phone_code_hash:r.phone_code_hash,phone_code:a};E.managers.apiManager.invokeApi("auth.signIn",t,{ignoreErrors:!0}).then(e=>{switch(e._){case"auth.authorization":E.managers.apiManager.setUser(e.user),v();break;case"auth.authorizationSignUpRequired":_(()=>import("./pageSignUp-910d5917.js"),["./pageSignUp-910d5917.js","./loginPage-db42028c.js","./index-d9a2bfe9.js","./index-5c4b8e53.css","./page-a83e8811.js","./wrapEmojiText-52efa31a.js","./button-38e16a92.js","./scrollable-18edb7c3.js"],import.meta.url).then(i=>{i.default.mount({phone_number:r.phone_number,phone_code_hash:r.phone_code_hash})}),v();break}}).catch(async e=>{let i=!1;switch(e.type){case"SESSION_PASSWORD_NEEDED":i=!0,e.handled=!0,await(await _(()=>import("./pagePassword-d3657e8d.js"),["./pagePassword-d3657e8d.js","./page-a83e8811.js","./index-d9a2bfe9.js","./index-5c4b8e53.css","./button-38e16a92.js","./wrapEmojiText-52efa31a.js","./loginPage-db42028c.js"],import.meta.url)).default.mount(),setTimeout(()=>{o.value=""},300);break;case"PHONE_CODE_EXPIRED":o.classList.add("error"),y(s.label,g("PHONE_CODE_EXPIRED"));break;case"PHONE_CODE_EMPTY":case"PHONE_CODE_INVALID":o.classList.add("error"),y(s.label,g("PHONE_CODE_INVALID"));break;default:s.label.innerText=e.type;break}i||s.select(),o.removeAttribute("disabled")})},D=()=>{m.pageEl.querySelector(".input-wrapper").append(s.container);const a=m.pageEl.querySelector(".phone-edit");a.append(T("edit")),S(a,()=>F.mount())},O=()=>{const a=m.pageEl.querySelector(".auth-image"),t=C.isMobile?100:166;if(r.type._==="auth.sentCodeTypeFragmentSms"){a.firstElementChild&&(l?.remove(),l=void 0,a.replaceChildren());const e=document.createElement("div");return e.classList.add("media-sticker-wrapper"),a.append(e),h.loadAnimationAsAsset({container:e,loop:!0,autoplay:!0,width:t,height:t},"jolly_roger").then(i=>(p=i,h.waitForFirstFrame(i))).then(()=>{})}else return a.firstElementChild&&(p?.remove(),p=void 0,a.replaceChildren()),l=new w(s,t),a.append(l.container),l.load()},m=new b("page-authCode",!0,D,a=>{if(r=a,!c)c=m.pageEl.getElementsByClassName("phone")[0],f=m.pageEl.getElementsByClassName("sent-type")[0];else{o.value="";const n=document.createEvent("HTMLEvents");n.initEvent("input",!1,!0),o.dispatchEvent(n)}const t=r.type.length;s||(s=new I({label:"Code",name:A(),length:t,onFill:n=>{P(n)}}),o=s.input),s.options.length=t,c.innerText=r.phone_number;let e,i;const d=r.type;switch(d._){case"auth.sentCodeTypeSms":e="Login.Code.SentSms";break;case"auth.sentCodeTypeApp":e="Login.Code.SentInApp";break;case"auth.sentCodeTypeCall":e="Login.Code.SentCall";break;case"auth.sentCodeTypeFragmentSms":e="PhoneNumber.Code.Fragment.Info";const n=document.createElement("a");L(n),n.href=d.url,i=[n];break;default:e="Login.Code.SentUnknown",i=[d._];break}return y(f,g(e,i)),E.managers.appStateManager.pushToState("authState",{_:"authStateAuthCode",sentCode:a}),O().catch(()=>{})},()=>{o.focus()});export{m as default};
//# sourceMappingURL=pageAuthCode-905d6cd8.js.map
