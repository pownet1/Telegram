import{o as $,p as R,I as p,a as l,j,c as z,i as H,_ as P,A as x}from"./index-d9a2bfe9.js";import{a as N,p as I,P as W}from"./page-a83e8811.js";import{T as G,B}from"./button-38e16a92.js";const J="Roboto",b=["b","Ð±"],C={},K={text:J,icons:G,monospace:"Roboto Mono"};function X(e={text:b,icons:void 0,monospace:b}){if(!("fonts"in document))return Promise.resolve();const t=[];for(const a in e){let n=e[a];n==="all"&&(n=b);const o=K[a],i=a==="icons"?[500]:[400,500];for(const c of i){const u=(n||[void 0]).map(v=>{var h,_;const f=[c,"1rem",o].join(" ");return(h=C[f]??(C[f]={}))[_=v||""]??(h[_]=document.fonts.load(f,v))});t.push(...u)}}return Promise.race([Promise.all(t).catch($),R(1e3)])}let A=!1;function Y(){return T||(T=l.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==p.lastRequestedLangCode?Promise.all([e,p.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),p.getCacheLangPack()]):[]))}let T;function Z(e){A||Y().then(([t,a])=>{if(!t)return;const n=[];a.forEach(c=>{const u=p.strings.get(c.key);u&&(n.push(u),p.strings.set(c.key,c))});const o="Login.ContinueOnLanguage",i=B("btn-primary btn-secondary btn-primary-transparent primary",{text:o});i.lastElementChild.classList.remove("i18n"),X({text:[p.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(i)})}),l.addEventListener("language_change",()=>{i.remove()},{once:!0}),n.forEach(c=>{p.strings.set(c.key,c)}),N(i,c=>{j(c),A=!0,i.disabled=!0,I(i),p.getLangPack(t.suggested_lang_code)})})}function U(e,t){return t?e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,""):e.replace(/-/g,"+").replace(/_/g,"/")}function ee(e,t){const a=e.length;if(a!==t.length)return!1;for(let n=0;n<a;++n)if(e[n]!==t[n])return!1;return!0}function te(e){let t,a="";for(let n=e.length,o=0,i=0;i<n;++i)t=i%3,o|=e[i]<<(16>>>t&24),(t===2||n-i===1)&&(a+=String.fromCharCode(E(o>>>18&63),E(o>>>12&63),E(o>>>6&63),E(o&63)),o=0);return a.replace(/A(?=A$|$)/g,"=")}function E(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}function ne(e){const t=new Blob([e],{type:"image/svg+xml;charset=utf-8"});return new Promise(a=>{const n=new FileReader;n.onload=o=>{a(o.target.result)},n.readAsDataURL(t)})}const O=3,re=async()=>{const t=M.pageEl.querySelector(".auth-image");let a=I(t,!0);const n=document.createElement("div");n.classList.add("input-wrapper");const o=B("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});n.append(o),Z(n);const i=t.parentElement,c=document.createElement("h4");z(c,"Login.QR.Title");const u=document.createElement("ol");u.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(d=>{const r=document.createElement("li");r.append(H(d)),u.append(r)}),i.append(c,u,n),o.addEventListener("click",()=>{P(()=>import("./pageSignIn-434b1a94.js"),["./pageSignIn-434b1a94.js","./index-d9a2bfe9.js","./index-5c4b8e53.css","./page-a83e8811.js","./button-38e16a92.js","./wrapEmojiText-52efa31a.js","./scrollable-18edb7c3.js"],import.meta.url).then(d=>d.default.mount()),g=!0});const f=(await Promise.all([P(()=>import("./qr-code-styling-8a04fb73.js").then(d=>d.q),["./qr-code-styling-8a04fb73.js","./_commonjsHelpers-725317a4.js"],import.meta.url)]))[0].default;let g=!1;l.addEventListener("user_auth",()=>{g=!0,y=null},{once:!0});const h={ignoreErrors:!0};let _;const q=async d=>{try{let r=await l.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:x.id,api_hash:x.hash,except_ids:[]},{ignoreErrors:!0});if(r._==="auth.loginTokenMigrateTo"&&(h.dcId||(h.dcId=r.dc_id,l.managers.apiManager.setBaseDcId(r.dc_id)),r=await l.managers.apiManager.invokeApi("auth.importLoginToken",{token:r.token},h)),r._==="auth.loginTokenSuccess"){const m=r.authorization;return l.managers.apiManager.setUser(m.user),!0}if(!_||!ee(_,r.token)){_=r.token;const m=te(r.token),w="tg://login?token="+U(m,!0),k=window.getComputedStyle(document.documentElement),D=k.getPropertyValue("--surface-color").trim(),Q=k.getPropertyValue("--primary-text-color").trim(),F=k.getPropertyValue("--primary-color").trim(),V=await fetch("assets/img/logo_padded.svg").then(s=>s.text()).then(s=>(s=s.replace(/(fill:).+?(;)/,`$1${F}$2`),ne(s))),L=new f({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:w,image:V,dotsOptions:{color:Q,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:D},qrOptions:{errorCorrectionLevel:"L"}});L.append(t),t.lastChild.classList.add("qr-canvas");let S;L._drawingPromise?S=L._drawingPromise:S=Promise.race([R(1e3),new Promise(s=>{L._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>s())},{once:!0})})]),await S.then(()=>{if(a){a.style.animation="hide-icon .4s forwards";const s=t.children[1];s.style.display="none",s.style.animation="grow-icon .4s forwards",setTimeout(()=>{s.style.display=""},150),setTimeout(()=>{s.style.animation=""},500),a=void 0}else Array.from(t.children).slice(0,-1).forEach(s=>{s.remove()})})}if(d){const m=Date.now()/1e3,w=r.expires-m-await l.managers.timeManager.getServerTimeOffset();await R(w>O?1e3*O:1e3*w|0)}}catch(r){switch(r.type){case"SESSION_PASSWORD_NEEDED":r.handled=!0,P(()=>import("./pagePassword-d3657e8d.js"),["./pagePassword-d3657e8d.js","./page-a83e8811.js","./index-d9a2bfe9.js","./index-5c4b8e53.css","./button-38e16a92.js","./wrapEmojiText-52efa31a.js","./loginPage-db42028c.js"],import.meta.url).then(m=>m.default.mount()),g=!0,y=null;break;default:console.error("pageSignQR: default error:",r),g=!0;break}return!0}return!1};return async()=>{g=!1;do if(g||await q(!0))break;while(!0)}};let y;const M=new W("page-signQR",!0,()=>y,()=>{y||(y=re()),y.then(e=>{e()}),l.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),se=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{se as a,Z as g,M as p};
//# sourceMappingURL=pageSignQR-f06ed543.js.map
