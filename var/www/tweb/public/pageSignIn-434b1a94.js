import{D as H,b as R,c as _,a as b,I as P,d as z,e as q,f as X,r as J,i as v,g as T,h as Q,s as M,j as F,k as N,A as V,_ as $,l as G,n as Y}from"./index-d9a2bfe9.js";import{s as Z,f as ee,P as te,p as se,a as ae}from"./page-a83e8811.js";import{r as O,B as A}from"./button-38e16a92.js";import{I as K,p as U,g as ne,w as ie,f as re,l as le,t as oe,r as C}from"./wrapEmojiText-52efa31a.js";import{p as ce,g as de}from"./pageSignQR-f06ed543.js";import{S as ue}from"./scrollable-18edb7c3.js";function he(h,e){const s=Array.isArray(e)?e:e.split(H);let t=h;for(const o of s)if(t=t?.[o],!t)break;return t}class pe{constructor(e={}){const s=this.label=document.createElement("label");s.classList.add("checkbox-field"),e.restriction&&!e.toggle&&s.classList.add("checkbox-field-restriction"),e.round&&s.classList.add("checkbox-field-round"),e.disabled&&this.toggleDisability(!0),this.listenerSetter=e.listenerSetter;const t=this.input=document.createElement("input");if(t.classList.add("checkbox-field-input"),t.type=e.asRadio?"radio":"checkbox",e.name&&(t[e.asRadio?"name":"id"]="input-"+e.name),e.checked&&(t.checked=!0),e.stateKey){let r=e.checked!==void 0;const c=()=>{if(!r)return;let l;e.stateValues?l=e.stateValues[t.checked?1:0]:(l=t.checked,e.stateValueReverse&&(l=!l)),b.managers.appStateManager.setByKey(e.stateKey,l)};!r&&R.getState().then(l=>{r=!0;const p=he(l,e.stateKey);let i;e.stateValues?i=e.stateValues.indexOf(p)===1:(i=p,e.stateValueReverse&&(i=!i)),this.setValueSilently(i)}),e.listenerSetter?e.listenerSetter.add(t)("change",c):t.addEventListener("change",c)}let o;if(e.text?(o=this.span=document.createElement("span"),o.classList.add("checkbox-caption"),_(o,e.text,e.textArgs)):s.classList.add("checkbox-without-caption"),s.append(t),e.toggle){s.classList.add("checkbox-field-toggle"),e.restriction&&s.classList.add("checkbox-field-toggle-restriction");const r=document.createElement("div");r.classList.add("checkbox-toggle");const c=document.createElement("div");c.classList.add("checkbox-toggle-circle"),r.append(c),s.append(r)}else{const r=document.createElement("div");r.classList.add("checkbox-box");const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.classList.add("checkbox-box-check"),c.setAttributeNS(null,"viewBox","0 0 24 24");const l=document.createElementNS("http://www.w3.org/2000/svg","use");l.setAttributeNS(null,"href","#check"),l.setAttributeNS(null,"x","-1"),c.append(l);const p=document.createElement("div");p.classList.add("checkbox-box-background");const i=document.createElement("div");i.classList.add("checkbox-box-border"),r.append(i,p,c),s.append(r)}o&&s.append(o),e.withRipple?(s.classList.add("checkbox-ripple","hover-effect"),O(s,void 0,void 0,!0)):e.withHover&&s.classList.add("hover-effect")}get checked(){return this.input.checked}set checked(e){this.setValueSilently(e),Z(this.input,"change")}setValueSilently(e){this.input.checked=e}isDisabled(){return this.label.classList.contains("checkbox-disabled")}toggleDisability(e){return this.label.classList.toggle("checkbox-disabled",e),this.input.disabled=e,()=>this.toggleDisability(!e)}}const x=new Map;let w=0;const D=(h,e,s="")=>{s=e.country_code+s,w=Math.max(w,s.length),x.set(s,{country:h,code:e})};function fe(h){h=h||"",x.size||P.countriesList.forEach(a=>{a.country_codes.forEach(n=>{n.prefixes?n.prefixes.forEach(u=>{D(a,n,u)}):D(a,n)})});let e=h.replace(/\D/g,"");const s=e.slice(0,w);let t;for(let a=s.length-1;a>=0&&(t=x.get(s.slice(0,a+1)),!t);--a);if(!t)return{formatted:e,country:void 0,code:void 0,leftPattern:""};const o=t.country,r=t.code.patterns||[],c=e.slice(t.code.country_code.length);let l="",p=0,i="";for(let a=r.length-1;a>=0;--a){l=r[a];const n=l.replace(/ /g,"");let u=0;for(let d=0,g=Math.min(c.length,n.length);d<g;++d)if(c[d]===n[d])u+=1.01;else if(n[d]==="X")++u;else{u=0;break}u>p&&(p=u,i=l)}l=i||l,l=l.replace(/\d/g,"X"),l=t.code.country_code+" "+l,l.split("").forEach((a,n)=>{a===" "&&e[n]!==" "&&e.length>n&&(e=e.slice(0,n)+" "+e.slice(n))});let f=l&&l.length>e.length?l.slice(e.length):"";return f&&(f=f.replace(/X/g,"â€’")),{formatted:e,country:o,code:t.code,leftPattern:f}}class ge extends K{constructor(e={}){super({label:"Contacts.PhoneNumber.Placeholder",name:"phone",...e}),this.pasted=!1,this.lastValue="",this.container.classList.add("input-field-phone");const s=this.input;if(s instanceof HTMLInputElement)s.type="tel",s.autocomplete="rr55RandomRR55";else{s.inputMode="decimal";const t=window.devicePixelRatio;if(t>1){let r;q?r=t*-.16:X&&(r=0),s.style.setProperty("--letter-spacing",r+"px")}const o=this.setValueSilently.bind(this);this.setValueSilently=r=>{o(r),U(this.input,!0)}}s.addEventListener("input",()=>{s.classList.remove("error");const t=this.value;Math.abs(t.length-this.lastValue.length)>1&&!this.pasted&&z&&this.setValueSilently(this.lastValue+t),this.pasted=!1,this.setLabel();let r,c,l="";this.value.replace(/\++/,"+")==="+"?this.setValueSilently("+"):(r=fe(this.value),c=r.formatted,r.country,l=r.leftPattern,r.code,this.setValueSilently(this.lastValue=c?"+"+c:"")),s.dataset.leftPattern=l,e.onInput&&e.onInput(r)}),s.addEventListener("paste",()=>{this.pasted=!0}),s.addEventListener("keypress",t=>{const o=t.key;if(/\D/.test(o)&&!(t.metaKey||t.ctrlKey)&&o!=="Backspace"&&!(o==="+"&&t.shiftKey))return t.preventDefault(),!1})}}let L;const B=()=>{L=P.countriesList.filter(h=>!h.pFlags?.hidden).sort((h,e)=>(h.name||h.default_name).localeCompare(e.name||e.default_name))};let I=()=>{I=void 0,B(),b.addEventListener("language_change",()=>{B()})};const W=new Set(["FT"]);function me(h,e){return I?.(),h=h.toLowerCase(),L.filter(t=>{if(e&&W.has(t.iso2))return!1;const o=[t.name,t.default_name,t.iso2];return o.filter(Boolean).forEach(c=>{const l=c.split(" ").filter(p=>/\w/.test(p)).map(p=>p[0]).join("");l.length>1&&o.push(l)}),!!o.filter(Boolean).find(c=>c.toLowerCase().indexOf(h)!==-1)})}class ye extends K{constructor(e={}){super({label:"Country",name:J(),...e}),this.options=e,this.hidePicker=()=>{this.hideTimeout===void 0&&(this.selectWrapper.classList.remove("active"),this.hideTimeout=window.setTimeout(()=>{this.selectWrapper.classList.add("hide"),this.hideTimeout=void 0},200))},this.selectCountryByTarget=i=>{const f=i.querySelector("[data-default-name]").dataset.defaultName,n=i.querySelector(".phone-code")?.innerText,u=n&&n.replace(/\D/g,"");this.value=v(f),this.lastCountrySelected=L.find(d=>d.default_name===f),this.lastCountryCodeSelected=u&&this.lastCountrySelected.country_codes.find(d=>d.country_code===u),this.options.onCountryChange?.(this.lastCountrySelected,this.lastCountryCodeSelected),this.hidePicker()},I?.(),this.liMap=new Map,this.container.classList.add("input-select");const s=this.selectWrapper=document.createElement("div");s.classList.add("select-wrapper","z-depth-3","hide");const t=document.createElement("span");t.classList.add("arrow","arrow-down"),this.container.append(t);const o=document.createElement("ul");s.appendChild(o),new ue(s);let r=()=>{r=null,L.forEach(i=>{if(e.noPhoneCodes&&W.has(i.iso2))return;const f=ne(i.iso2),a=[];for(let n=0,u=Math.min(i.country_codes.length,e.noPhoneCodes?1:1/0);n<u;++n){const d=i.country_codes[n],g=document.createElement("li"),S=ie(f);if(Q){const y=document.createElement("span");M(y,S),g.append(y)}else M(g,S);const E=v(i.default_name);if(E.dataset.defaultName=i.default_name,g.append(E),!e.noPhoneCodes){const y=document.createElement("span");y.classList.add("phone-code"),y.innerText="+"+d.country_code,g.appendChild(y)}a.push(g),o.append(g)}this.liMap.set(i.iso2,a)}),o.addEventListener("mousedown",i=>{if(i.button!==0)return;const f=re(i.target,"LI");this.selectCountryByTarget(f)}),this.container.appendChild(s)};r(),this.input.addEventListener("focus",i=>{r?r():L.forEach(f=>{const a=this.liMap.get(f.iso2);a&&a.forEach(n=>n.style.display="")}),clearTimeout(this.hideTimeout),this.hideTimeout=void 0,s.classList.remove("hide"),s.offsetWidth,s.classList.add("active"),this.select(),ee({container:T(this.container,"scrollable-y"),element:this.input,position:"start",margin:4}),setTimeout(()=>{c||(document.addEventListener("mousedown",l,{capture:!0}),c=!0)},0)});let c=!1;const l=i=>{T(i.target,"input-select")||i.target!==this.input&&(this.hidePicker(),document.removeEventListener("mousedown",l,{capture:!0}),c=!1)},p=i=>{const f=i.key;if(i.ctrlKey||f==="Control")return!1;const a=new Set(me(this.value).map(n=>n.iso2));this.liMap.forEach((n,u)=>{n.forEach(d=>d.style.display=a.has(u)?"":"none")}),a.size?a.size===1&&f==="Enter"&&(F(i),this.selectCountryByTarget(this.liMap.get([...a][0])[0])):L.forEach(n=>{const u=this.liMap.get(n.iso2);u&&u.forEach(d=>d.style.display="")})};this.input.addEventListener("keyup",p),this.input.addEventListener("keydown",i=>{i.key==="Enter"&&p(i)}),t.addEventListener("mousedown",i=>{this.input.matches(":focus")?(this.hidePicker(),this.input.blur()):(i.cancelBubble=!0,i.preventDefault(),this.input.focus())})}getSelected(){return{country:this.lastCountrySelected,code:this.lastCountryCodeSelected}}selectCountryByIso2(e){this.selectCountryByTarget(this.liMap.get(e)[0])}override(e,s,t){this.setValueSilently(e?v(e.default_name):t),this.lastCountrySelected=e,this.lastCountryCodeSelected=s,this.options.onCountryChange?.(this.lastCountrySelected,this.lastCountryCodeSelected)}}let m=null,k;const be=()=>{const h=document.createElement("div");h.classList.add("input-wrapper");let e,s;const t=new ye({onCountryChange:(a,n)=>{e=a,s=n,n&&(o.value=o.lastValue="+"+n.country_code,setTimeout(()=>{r.focus(),U(r,!0)},0))}}),o=new ge({onInput:a=>{le.loadLottieWorkers();const{country:n,code:u}=a||{},d=n?n.name||n.default_name:"";d!==t.value&&(!e||!n||!u||e!==n&&s.country_code!==u.country_code)&&t.override(n,u,d),n||o.value.length-1>1?m.style.visibility="":m.style.visibility="hidden"}}),r=o.input;r.addEventListener("keypress",a=>{if(!m.style.visibility&&a.key==="Enter")return l()});const c=new pe({text:"Login.KeepSigned",name:"keepSession",withRipple:!0,checked:!0});c.input.addEventListener("change",()=>{const a=c.checked;b.managers.appStateManager.pushToState("keepSigned",a)}),R.getState().then(a=>{N.isAvailable()?c.checked=a.keepSigned:(c.checked=!1,c.label.classList.add("checkbox-disabled"))}),m=A("btn-primary btn-color-primary",{text:"Login.Next"}),m.style.visibility="hidden";const l=a=>{a&&F(a);const n=oe([m,k],!0);C(m,v("PleaseWait")),se(m);const u=o.value;b.managers.apiManager.invokeApi("auth.sendCode",{phone_number:u,api_id:V.id,api_hash:V.hash,settings:{_:"codeSettings",pFlags:{}}}).then(d=>{if(d._==="auth.sentCodeSuccess"){const{authorization:g}=d;g._==="auth.authorization"&&b.managers.apiManager.setUser(g.user)}$(()=>import("./pageAuthCode-905d6cd8.js"),["./pageAuthCode-905d6cd8.js","./index-d9a2bfe9.js","./index-5c4b8e53.css","./page-a83e8811.js","./wrapEmojiText-52efa31a.js","./button-38e16a92.js","./pageSignQR-f06ed543.js","./scrollable-18edb7c3.js"],import.meta.url).then(g=>g.default.mount(Object.assign(d,{phone_number:u})))}).catch(d=>{switch(n(),d.type){case"PHONE_NUMBER_INVALID":o.setError(),C(o.label,v("Login.PhoneLabelInvalid")),r.classList.add("error"),C(m,v("Login.Next"));break;default:console.error("auth.sendCode error:",d),m.innerText=d.type;break}})};ae(m,l),k=A("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Login"}),k.addEventListener("click",()=>{ce.mount()}),h.append(t.container,o.container,c.label,m,k);const p=document.createElement("h4");p.classList.add("text-center"),_(p,"Login.Title");const i=document.createElement("div");i.classList.add("subtitle","text-center"),_(i,"Login.StartText"),ve.pageEl.querySelector(".container").append(p,i,h);const f=()=>{b.managers.apiManager.invokeApi("help.getNearestDc").then(a=>{const n=N.getFromCache("langPack");n&&!n.countries?.hash&&P.getLangPack(n.lang_code).then(()=>{o.simulateInputEvent()});const u=new Set([1,2,3,4,5]),d=[a.this_dc];let g;return a.nearest_dc!==a.this_dc&&(g=b.managers.apiManager.getNetworkerVoid(a.nearest_dc).then(()=>{d.push(a.nearest_dc)})),(g||Promise.resolve()).then(()=>{d.forEach(y=>{u.delete(y)});const S=[...u],E=async()=>{const y=S.shift();if(!y)return;const j=`dc${y}_auth_key`;if(await Y.get(j))return E();setTimeout(()=>{b.managers.apiManager.getNetworkerVoid(y).finally(E)},3e3)};E()}),a}).then(a=>{!t.value.length&&!o.value.length&&t.selectCountryByIso2(a.country)})};G||setTimeout(()=>{r.focus()},0),de(h),f()},ve=new te("page-sign",!0,be,()=>{m&&(C(m,v("Login.Next")),O(m,void 0,void 0,!0),m.removeAttribute("disabled")),k&&k.removeAttribute("disabled"),b.managers.appStateManager.pushToState("authState",{_:"authStateSignIn"})});export{ve as default};
//# sourceMappingURL=pageSignIn-434b1a94.js.map
